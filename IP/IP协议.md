## IP协议

---

**MTU** 

最大传输单元

**分片**

路由器将需要传输的，大于MTU的IP数据进行分片，分片之后的IP数据报只能由目标主机重组。
IP首部中的“片偏移”表示分片之后每个分片在用户数据中的相对位置，和之后是否还有其他分片。

**路径MTU**

从发送端主机到接收端主机之间不需要分片时最大的MTU大小。就是数据链路中最小的MTU。

---

###IPv6

128bit，8个16位字节

特点

- IP地址的扩大和路由控制表的聚合。
- 性能提升。路由器不再需要分片处理，由发送端主机进行分片处理。
- 支持即插即用，没有DHCP也可自动分配IP地址。
- 支持认证和加密功能。
- 多播/Mobile IP成为扩展功能

如果出现连续的0时可以用两个冒号代替。一个IP地址中指允许出现一次两个连续的冒号。

--- 

### IPv4首部

**版本**

4bit，标识IP首部的版本号。

**首部长度**

4bit，IP首部的大小。

**区分服务**

8bit，表明服务质量。

**DSCP段和ECN段**

**总长度**

16bit，IP首部和数据的总字节数。

**标识**

16bit，用于分片重组。

**标志**

3bit，包被分片的相关信息。

**片偏移**

13bit，分片的每一个分段相对于原始数据的位置。

**生存时间**

8bit

**协议**

8bit，表示IP首部的下一首部的协议。

**首部校验和**

16bit

**源地址**

**目标地址**

**可选项**

**填充**

**数据**

---

###ARP

根据IP地址定位下一跳的网络设备的MAC地址。仅使用与IPv4。

---

###ICMP

确认IP包是否成功送达目标地址，通知在发送过程当中IP包被废弃的原因。

---

###ICMPv6

在IPv6中，从IP地址定位MAC地址的协议从ARP转为ICMP的邻居探索消息。融合了IPv4的ARP/ICMP重定向和ICMP路由器选择消息等功能，还提供自动设置IP地址的功能。

---

###NAT

用于本地网络中使用私有地址，连接互联网是转换为全局IP地址。还可以转换TCP,UDP端口号的成为NAPT。
在NAT路由器内部，有一张自动生成用来转换地址的表。在建立TCP连接首次握手时的SYN包经路由发出，就会生成此表，收到关闭连接时发出的FIN包的确认应答从表中删除。

**NAT-PT**

只有IPv6地址的主机也能于IPv4地址的主机通信的技术。

**NAT限制**

- 无法从NAT外部向内部建立连接
- 转换表的生成与转换操作都需要开销
- 通信过程中遇到重启，所有TCP连接都被重置




