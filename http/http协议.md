##HTTP协议

###http请求及响应过程

[当你输入一个网址的时候，实际会发生什么?](http://www.cnblogs.com/wenanry/archive/2010/02/25/1673368.html)

---

###基于TCP连接

HTTP协议基于TCP/IP协议。TCP接收到HTTP数据之后，处理成段进行网络传输。
TCP段数据由IP分组来定义，IP分组组成部分：

- 一个IP分组首部(包含源IP，目标IP，首部校验和及其他信息)，
- 一个TCP段首部(源端口，目标端口，TCP段序号，确认信息)，
- 一个TCP数据块(HTTP数据)。

> 一个HTTP请求可能会被分为多个TCP段，所以需要TCP段序号。

HTTP传输报文，以流的形式将数据通过已经连接的TCP连接按序传输。
HTTPS在HTTP和TCP之间插入了一个密码加密层，使用TLS或SSL。

---

###TCP套接字

TCP API   隐藏了所有底层的网络协议的握手细节，TCP数据流与IP分组之间的分段和重装细节。

---

###TCP性能

HTTP事务的处理过程中，可能用于建立TCP连接和传输数据的时间会占不小的比例。
因为TCP段需要添加除HTTP信息意外的数据，所以越小的HTTP事务TCP的连接开销比例越大。

每个TCP段都包含一个序列号和数据完整性校验和，发送者如果在指定的时间没有接收到接受者的确认信息，就重新数据。

TIME_WAIT积累耗尽端口。关闭TCP连接之后的2MSL（1MSL为1分钟，称为最大分段使用期）时间内，在内存中记录关闭的IP和端口信息。另外每个客户端的TCP连接都会使用不同端口进行连接传输数据，所以绑定了一个IP一个端口的系统中，默认情况下TCP连接限制在大约500次/秒（系统端口资源60000/2MSL为120S，而60000和2MSL可以进行调整）。

