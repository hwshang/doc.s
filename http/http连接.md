##HTTP 连接

- 并行连接
- 持久连接
- 管道化连接
- 复用的连接

---

###并行连接

建立多条TCP连接处理HTTP请求

即客户端得到HTTP请求的第一个为HTML页面的响应之后，通过建立多条TCP连接请求HTML文件中的元素。
需要注意的是，并行连接缩短了HTTP的请求响应时间，那么在同一时刻，服务器需要处理的请求变成了N倍。所以，请求量大的时候，需要将HTML页面中的不同元素分布在不同的机器上。
同时，不同的浏览器对同一域名的请求有并发限制，通常为2-8个。

---

###持久连接

重用TCP连接，减少重建TCP连接时间

通常一个WEB页面包含了多个元素，需要通过多个HTTP请求进行获取，多个请求需要建立多个TCP连接。
而持久连接就是要通过一个TCP连接传输多个HTTP请求。在建立了第一个TCP连接完成第一个HTTP请求之后，不中断TCP连接，直到服务端和客户端都决定关闭。所以*持久连接减少的重建TCP连接的时间*。前提是这些HTTP请求在一个WEB站点上。
事物处理完成之后仍然保持在打开状态的TCP连接成为**持久连接**。

**Keep-Alive**
持久连接需要客户端和服务端都支持，客户端在首部中添加 `Connection: Keep-Alive` ，服务器会在响应中添加相同的首部，否则，客户端认为服务器不支持Keep-Alive，接受响应报文之后关闭连接。
Keep-Alive可选(有Connection: Keep-Alive才会在 *响应报文* 中有Keep-Alive首部)首部的参数： `timeout=10` `max=30` 说明服务器最多还会为另外30个事务保持连接的开打状态，或者将打开状态保持到连接空闲了10s之后关闭。

**当Keep-Alive遇到代理**
代理服务器不会转发 `Connection` 和它的值的首部，比如 `Keep-Alive` 。不能处理并进行了转发 `Connection` 的代理称为 *盲中继* ，它欺骗了客户端和服务端都建立了 `Keep-Alive` 连接，自己却不能处理请求。  

**Proxy-Connection**
这是用来对应单个代理服务器不能识别`Connection` 的首部，代替HTTP原版的`Connection`。
不能识别的代理，只管转发此首部，服务器和客户端也都会忽略。
能够识别的代理，会将客户端发送的 `Proxy-Connection: Keep-Alive` 替换为 `Connection: Keep-Alive` 转发请求给服务器，三个角色之间就可以建立持久连接。
如果客户端和服务端中间有多个代理，还是会有问题。

**persistent connection**
HTTP/1.1版本中，持久连接从选配变成为了标配。当需要关闭连接时发送请求首部添加 ` Connection: close` 。
即使不发送` Connection: close` ，服务器也不会一直处于连接打开状态。

**疑问: 从浏览器的headers中看到HTTP/1.1请求还是有Connection:keep-alive ，有何意义？**

---

###管道化连接

通过共享的TCP连接并发处理HTTP请求

HTTP请求共用TCP连接，并且发出多个请求等待响应，在服务器返回数据是也要按照请求的顺序发送。因为HTTP报文没有序列号，TCP有。

---

###复用的连接

交替传输请求和响应报文(实验阶段)
